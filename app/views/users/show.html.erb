<link rel="stylesheet" href="https://openlayers.org/en/v4.0.1/css/ol.css" type="text/css">
    <!-- The line below is only needed for old environments like Internet Explorer and Android 4.x -->
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
    <script src="https://openlayers.org/en/v4.0.1/build/ol.js"></script>
    <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<div class="container">
    <div class="row">
        <div class="col-md-3">
            <h2><%= @user.first_name %> 
                <%= @user.last_name %></h2><br>
            <%= form_for @user do |profile| %>
            <p class ="profile"><%= image_tag @user.profile.thumb.url if @user.profile? %></p><br>
            <h4><%= profile.label :edit_profile_picture %></h4>
            <%= profile.file_field :profile %><br>
            <%= profile.button 'Upload', type: 'submit' %>
            <% end %>

            <hr></hr>
          
            <% if @client.nil? %>
            <%= link_to "Get stats from Strava", "/auth/strava" %><br>



            <% else %>
              <h2 class = "bgwell text-center">Latest runs from <%= link_to "https://www.strava.com/dashboard" do %>
   <%= image_tag "strava.png" %>
<% end %></h2>
              <h5 class = "text-center">
              <p class ="bgwell"><b>Date</b>            <%=   Date.strptime((@runs[0]["start_date"]).gsub(/[T.*]/, ""), "%Y-%m-%d")  %></p>   
              <p><b>Distance</b>  <%= (@runs[0]["distance"]/1000).round(2) %> km</p>
              <p><b>Time</b>       <%= (@runs[0]["moving_time"].to_f/60).round(2) %></p>
              <p><b>Pace</b>       <%= ((@runs[0]["moving_time"].to_f/60)/(@runs[0]["distance"]/1000)).round(2) %> min/km</p>
              <p><b>Average Speed</b>  <%= (@runs[0]["average_speed"]).round(1) %> mph</p>
              <p><b>Max Speed</b>     <%= (@runs[0]["max_speed"]).round(1)%> mph</p>
              <br/>
              <hr></hr>
                <% if @runs[1] %>
              <p class ="bgwell"><b>Date</b>           <%=   Date.strptime((@runs[1]["start_date"]).gsub(/[T.*]/, ""), "%Y-%m-%d")  %>
              <p><b>Distance</b>   <%= (@runs[1]["distance"]/1000).round(2) %> km</p>
              <p><b>Time</p></b>      <%= (@runs[1]["moving_time"].to_f/60).round(2) %> minutes </p>
              <p><b>Pace</b>       <%= ((@runs[1]["moving_time"].to_f/60)/(@runs[0]["distance"]/1000)).round(2) %> min/km</p>
              <p><b>Average Speed</b>  <%= (@runs[1]["average_speed"]).round(1) %> mph </p>
              <p><b>Max Speed</b>      <%= (@runs[1]["max_speed"]).round(1) %> mph </p><br>
                <% end %>
                 <hr></hr>
                <% if @runs[2] %>
              <p class ="bgwell"><b>Date</b>           <%=   Date.strptime((@runs[2]["start_date"]).gsub(/[T.*]/, ""), "%Y-%m-%d")  %> 
              <p><b>Distance</b>  <%= (@runs[2]["distance"]/1000).round(2) %> km</p>
              <p><b>Time</b>       <%= (@runs[2]["moving_time"].to_f/60).round(2) %> minutes </p>
              <p><b>Pace</b>      <%= ((@runs[2]["moving_time"].to_f/60)/(@runs[0]["distance"]/1000)).round(2) %> min/km</p>
              <p><b>Average Speed</b>  <%= (@runs[2]["average_speed"]).round(1) %> mph </p>
              <p><b>Max Speed</b>      <%= (@runs[2]["max_speed"]).round(1) %> mph </p><br/>
              <% end %>
              <% end %>
              </h5>
        </div>




    <div class="col-md-9">
    <h2 class="text-center">"WHO RUN THE WORLD?"</h2>
      <div id="map" class="map">
      </div>

      <script type="text/javascript">
        var layer = new ol.layer.Tile({
          source: new ol.source.OSM()
        });

        var map = new ol.Map({
          layers: [layer],
          target: 'map',
          view: new ol.View({
            center: [0,0],
            zoom: 2
          })
        });
      </script>

      <div style="display: none;">

        <% @u_reviews.all.each do |pinned| %>

            <div id="marker_<%= pinned.id %>" title="pin_<%= pinned.place.id %>">
            <i class="material-icons" style="color: red;">location_on</i>
      </div>


      <% if @u_reviews != nil %>
      <div style="display: none;">
        <% @u_reviews.each do |pinned| %>

      <div id="marker_<%= pinned.id %>" title="pin_<%= pinned.place.id %>">
      <i class="material-icons" style="color: red;">location_on</i>
      </div>

          <script type="text/javascript">
            var pos = ol.proj.fromLonLat([<%= pinned.place.longitude %>, <%= pinned.place.latitude %>]);

      map.on('click', function() {
      map.getView().setZoom(map.getView().getZoom()+1);    
      });


    </script>
        <% end %>
      </div>
    <% end %>
</div>


<h2 class="text-center"><%= @user.first_name %> does. </h2>

<hr></hr>

<!--run anywhere yet? code for users with no reviews does not work -->


<h2> Places you've run: </h2>
<% @u_reviews.all.each do |pinned| %>
 <h2><i class="material-icons" style="color: red;">location_on</i><%= link_to pinned.place.name, place_path(pinned.place) %><hr></hr></h2>
</r>
            // individual markers
            var marker = new ol.Overlay({
              position: pos,
              positioning: 'center-center',
              element: document.getElementById("marker_<%= pinned.id %>"),
              stopEvent: false
            });
            map.addOverlay(marker);
          </script>
        <% end %>
      </div>
    </div>

   <div class="col-md-1">
   </div>

 </div>

</div>


<h2>Scouted:</h2>
<tr>
<thead>
  <th>Location: </th>
  <th>Longitude: </th>
  <th>Latitude: </th>
  <th>Difficulty: </th>
</thead>
</tr>
<% @u_reviews.all.each do |pinned| %>
<tr>
<tbody>
  <td><%= link_to pinned.place.name, place_path(pinned.place) %></td>
  <td><%= pinned.place.longitude %></td>
  <td><%= pinned.place.latitude %></td>
  <td><%= pinned.place.difficulty %></td>
</tbody>
</tr>


<h2>Pinned places:</h2>
<% @u_reviews.all.each do |pinned| %>
  <p><%= pinned.place.name %></p>

  <p><%= pinned.place.longitude %></p>
  <p><%= pinned.place.latitude %></p><br>

  <p><%= pinned.place.longitude %></p<script>

      var pos = ol.proj.fromLonLat([<%= pinned.place.longitude %>, <%= pinned.place.latitude %>]);

      // individual markers
      var marker = new ol.Overlay({
        position: pos,
        positioning: 'center-center',
        element: document.getElementById("marker_<%= pinned.id %>"),
        stopEvent: false
      });
      map.addOverlay(marker);

      map.on('click', function() {
      map.getView().setZoom(map.getView().getZoom()+1);    
      });


    </script>
        <% end %>
      </div>
    <% end %>
</div>


<h2 class="text-center"><%= @user.first_name %> does. </h2>

<hr></hr>


<h2> Places you've run: </h2>
<% @u_reviews.all.each do |pinned| %>
 <h2><i class="material-icons" style="color: red;">location_on</i><%= link_to pinned.place.name, place_path(pinned.place) %><hr></hr></h2>
</r>

<%end%>
</div>
    </div>

    <%= link_to "All runners", users_path %>

